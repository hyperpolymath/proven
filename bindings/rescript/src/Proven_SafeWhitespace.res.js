// Generated by ReScript, PLEASE EDIT WITH CARE

import * as Belt_Array from "rescript/lib/es6/belt_Array.js";

var invisibleChars = [
  {
    codePoint: 0,
    name: "NULL",
    category: "control",
    isSafe: false
  },
  {
    codePoint: 9,
    name: "TAB",
    category: "whitespace",
    isSafe: true
  },
  {
    codePoint: 10,
    name: "LF",
    category: "linebreak",
    isSafe: true
  },
  {
    codePoint: 11,
    name: "VTAB",
    category: "whitespace",
    isSafe: true
  },
  {
    codePoint: 12,
    name: "FORM_FEED",
    category: "whitespace",
    isSafe: true
  },
  {
    codePoint: 13,
    name: "CR",
    category: "linebreak",
    isSafe: true
  },
  {
    codePoint: 32,
    name: "SPACE",
    category: "whitespace",
    isSafe: true
  },
  {
    codePoint: 133,
    name: "NEL",
    category: "linebreak",
    isSafe: true
  },
  {
    codePoint: 160,
    name: "NBSP",
    category: "invisible",
    isSafe: true
  },
  {
    codePoint: 5760,
    name: "OGHAM_SPACE",
    category: "whitespace",
    isSafe: true
  },
  {
    codePoint: 8192,
    name: "EN_QUAD",
    category: "whitespace",
    isSafe: true
  },
  {
    codePoint: 8193,
    name: "EM_QUAD",
    category: "whitespace",
    isSafe: true
  },
  {
    codePoint: 8194,
    name: "EN_SPACE",
    category: "whitespace",
    isSafe: true
  },
  {
    codePoint: 8195,
    name: "EM_SPACE",
    category: "whitespace",
    isSafe: true
  },
  {
    codePoint: 8196,
    name: "THREE_PER_EM",
    category: "whitespace",
    isSafe: true
  },
  {
    codePoint: 8197,
    name: "FOUR_PER_EM",
    category: "whitespace",
    isSafe: true
  },
  {
    codePoint: 8198,
    name: "SIX_PER_EM",
    category: "whitespace",
    isSafe: true
  },
  {
    codePoint: 8199,
    name: "FIGURE_SPACE",
    category: "whitespace",
    isSafe: true
  },
  {
    codePoint: 8200,
    name: "PUNCTUATION_SPACE",
    category: "whitespace",
    isSafe: true
  },
  {
    codePoint: 8201,
    name: "THIN_SPACE",
    category: "whitespace",
    isSafe: true
  },
  {
    codePoint: 8202,
    name: "HAIR_SPACE",
    category: "whitespace",
    isSafe: true
  },
  {
    codePoint: 8203,
    name: "ZWSP",
    category: "invisible",
    isSafe: true
  },
  {
    codePoint: 8204,
    name: "ZWNJ",
    category: "invisible",
    isSafe: false
  },
  {
    codePoint: 8205,
    name: "ZWJ",
    category: "invisible",
    isSafe: false
  },
  {
    codePoint: 8206,
    name: "LRM",
    category: "formatting",
    isSafe: true
  },
  {
    codePoint: 8207,
    name: "RLM",
    category: "formatting",
    isSafe: true
  },
  {
    codePoint: 8232,
    name: "LINE_SEP",
    category: "linebreak",
    isSafe: true
  },
  {
    codePoint: 8233,
    name: "PARA_SEP",
    category: "linebreak",
    isSafe: true
  },
  {
    codePoint: 8239,
    name: "NNBSP",
    category: "whitespace",
    isSafe: true
  },
  {
    codePoint: 8287,
    name: "MMSP",
    category: "whitespace",
    isSafe: true
  },
  {
    codePoint: 8288,
    name: "WJ",
    category: "invisible",
    isSafe: true
  },
  {
    codePoint: 12288,
    name: "IDEOGRAPHIC_SPACE",
    category: "whitespace",
    isSafe: true
  },
  {
    codePoint: 65279,
    name: "BOM",
    category: "invisible",
    isSafe: true
  }
];

function getInvisibleCharInfo(codePoint) {
  return Belt_Array.getBy(invisibleChars, (function (c) {
                return c.codePoint === codePoint;
              }));
}

function isInvisible(codePoint) {
  return Belt_Array.some(invisibleChars, (function (c) {
                return c.codePoint === codePoint;
              }));
}

function canSafelyRemove(codePoint) {
  var info = getInvisibleCharInfo(codePoint);
  if (info !== undefined) {
    return info.isSafe;
  } else {
    return false;
  }
}

function trimStart(input) {
  return input.replace(/^[\s\u00A0\u200B\uFEFF]+/, "");
}

function trimEnd(input) {
  return input.replace(/[\s\u00A0\u200B\uFEFF]+$/, "");
}

function trim(input) {
  return trimEnd(trimStart(input));
}

function collapseSpaces(input) {
  return input.replace(/[ ]{2,}/g, " ");
}

function collapseBlankLines(input, maxBlanks) {
  var pattern = maxBlanks <= 0 ? /\n{2,}/g : (
      maxBlanks === 1 ? /\n{3,}/g : /\n{3,}/g
    );
  var replacement = maxBlanks <= 0 ? "\n" : Belt_Array.make(maxBlanks + 1 | 0, "").join("\n");
  return input.replace(pattern, replacement);
}

function detectLineEnding(input) {
  var hasCRLF = input.includes("\r\n");
  var hasCR = input.includes("\r") && !hasCRLF;
  var hasLF = input.includes("\n") && !hasCRLF;
  if (hasCRLF) {
    if (hasCR || hasLF) {
      return "Mixed";
    } else {
      return "CRLF";
    }
  } else if (hasCR) {
    if (hasLF) {
      return "Mixed";
    } else {
      return "CR";
    }
  } else {
    return "LF";
  }
}

function normalizeLineEndings(input, target) {
  var normalized;
  switch (target) {
    case "CRLF" :
        normalized = "\r\n";
        break;
    case "CR" :
        normalized = "\r";
        break;
    case "LF" :
    case "Mixed" :
        normalized = "\n";
        break;
    
  }
  return input.replace(/\r\n/g, "\n").replace(/\r/g, "\n").replace(/\n/g, normalized);
}

function ensureFinalNewline(input) {
  var trimmed = trimEnd(input);
  return trimmed + "\n";
}

function removeFinalNewline(input) {
  if (input.endsWith("\n")) {
    return input.slice(0, input.length - 1 | 0);
  } else {
    return input;
  }
}

function nbspToSpace(input) {
  return input.replace(/\u00A0/g, " ");
}

function removeZwsp(input) {
  return input.replace(/\u200B/g, "");
}

function removeBom(input) {
  return input.replace(/\uFEFF/g, "");
}

function removeInvisibles(input) {
  return removeBom(removeZwsp(nbspToSpace(input))).replace(/\u200E/g, "").replace(/\u200F/g, "").replace(/\u2060/g, "");
}

function normalize(input) {
  return ensureFinalNewline(trim(collapseBlankLines(collapseSpaces(normalizeLineEndings(removeInvisibles(input), "LF")), 2)));
}

function detectInvisibles(input) {
  var results = {
    contents: []
  };
  var lines = input.split("\n");
  Belt_Array.forEachWithIndex(lines, (function (lineIdx, lineText) {
          for(var colIdx = 0 ,colIdx_finish = lineText.length; colIdx < colIdx_finish; ++colIdx){
            var codePoint = lineText.charCodeAt(colIdx) | 0;
            var info = getInvisibleCharInfo(codePoint);
            if (info !== undefined && info.category === "invisible") {
              results.contents = Belt_Array.concat(results.contents, [{
                      line: lineIdx + 1 | 0,
                      column: colIdx + 1 | 0,
                      codePoint: codePoint,
                      name: info.name,
                      category: info.category
                    }]);
            }
            
          }
        }));
  return results.contents;
}

function wordCount(input) {
  var trimmed = trim(input);
  if (trimmed.length === 0) {
    return 0;
  } else {
    return trimmed.split(/\s+/).length;
  }
}

function charCountNoWhitespace(input) {
  return input.replace(/\s/g, "").length;
}

function charCount(input) {
  return input.length;
}

function truncateWords(input, maxWords) {
  if (maxWords <= 0) {
    return "";
  }
  var words = trim(input).split(/\s+/);
  var truncated = Belt_Array.slice(words, 0, maxWords);
  return Belt_Array.keepMap(truncated, (function (w) {
                  return w;
                })).join(" ");
}

function truncateChars(input, maxChars) {
  if (maxChars <= 0) {
    return "";
  }
  if (input.length <= maxChars) {
    return input;
  }
  var truncated = input.slice(0, maxChars);
  var lastSpace = truncated.lastIndexOf(" ");
  if (lastSpace > 0) {
    return truncated.slice(0, lastSpace);
  } else {
    return truncated;
  }
}

export {
  invisibleChars ,
  getInvisibleCharInfo ,
  isInvisible ,
  canSafelyRemove ,
  trimStart ,
  trimEnd ,
  trim ,
  collapseSpaces ,
  collapseBlankLines ,
  detectLineEnding ,
  normalizeLineEndings ,
  ensureFinalNewline ,
  removeFinalNewline ,
  nbspToSpace ,
  removeZwsp ,
  removeBom ,
  removeInvisibles ,
  normalize ,
  detectInvisibles ,
  wordCount ,
  charCountNoWhitespace ,
  charCount ,
  truncateWords ,
  truncateChars ,
}
/* No side effect */
