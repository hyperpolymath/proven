// Generated by ReScript, PLEASE EDIT WITH CARE

import * as Belt_Int from "rescript/lib/es6/belt_Int.js";
import * as Belt_Array from "rescript/lib/es6/belt_Array.js";

function recordTypeFromString(str) {
  var match = str.toUpperCase();
  switch (match) {
    case "A" :
        return "A";
    case "AAAA" :
        return "AAAA";
    case "CAA" :
        return "CAA";
    case "CNAME" :
        return "CNAME";
    case "MX" :
        return "MX";
    case "NAPTR" :
        return "NAPTR";
    case "NS" :
        return "NS";
    case "PTR" :
        return "PTR";
    case "SOA" :
        return "SOA";
    case "SRV" :
        return "SRV";
    case "TXT" :
        return "TXT";
    default:
      return ;
  }
}

function recordTypeToString(rt) {
  switch (rt) {
    case "A" :
        return "A";
    case "NS" :
        return "NS";
    case "CNAME" :
        return "CNAME";
    case "SOA" :
        return "SOA";
    case "PTR" :
        return "PTR";
    case "MX" :
        return "MX";
    case "TXT" :
        return "TXT";
    case "AAAA" :
        return "AAAA";
    case "SRV" :
        return "SRV";
    case "NAPTR" :
        return "NAPTR";
    case "CAA" :
        return "CAA";
    
  }
}

function recordTypeValue(rt) {
  switch (rt) {
    case "A" :
        return 1;
    case "NS" :
        return 2;
    case "CNAME" :
        return 5;
    case "SOA" :
        return 6;
    case "PTR" :
        return 12;
    case "MX" :
        return 15;
    case "TXT" :
        return 16;
    case "AAAA" :
        return 28;
    case "SRV" :
        return 33;
    case "NAPTR" :
        return 35;
    case "CAA" :
        return 257;
    
  }
}

function recordClassFromString(str) {
  var match = str.toUpperCase();
  switch (match) {
    case "CH" :
        return "CH";
    case "CS" :
        return "CS";
    case "HS" :
        return "HS";
    case "IN" :
        return "IN";
    default:
      return ;
  }
}

function recordClassToString(rc) {
  switch (rc) {
    case "IN" :
        return "IN";
    case "CS" :
        return "CS";
    case "CH" :
        return "CH";
    case "HS" :
        return "HS";
    
  }
}

function isAlnum($$char) {
  var code = $$char.charCodeAt(0) | 0;
  if (code >= 48 && code <= 57 || code >= 65 && code <= 90) {
    return true;
  } else if (code >= 97) {
    return code <= 122;
  } else {
    return false;
  }
}

function isValidLabel(label) {
  var length = label.length;
  if (length === 0 || length > 63) {
    return false;
  }
  var firstChar = label.charAt(0);
  var lastChar = label.charAt(length - 1 | 0);
  if (!isAlnum(firstChar) || !isAlnum(lastChar)) {
    return false;
  }
  var valid = true;
  for(var i = 0; i < length; ++i){
    if (valid) {
      var $$char = label.charAt(i);
      if (!isAlnum($$char) && $$char !== "-") {
        valid = false;
      }
      
    }
    
  }
  if (valid && length >= 4) {
    var char2 = label.charAt(2);
    var char3 = label.charAt(3);
    if (char2 === "-" && char3 === "-" && !label.startsWith("xn--")) {
      valid = false;
    }
    
  }
  return valid;
}

function isValidDomainName(domain) {
  var length = domain.length;
  if (length === 0 || length > 253) {
    return false;
  }
  var name = domain.charAt(length - 1 | 0) === "." ? domain.slice(0, length - 1 | 0) : domain;
  if (name.length === 0) {
    return false;
  }
  var labels = name.split(".");
  var labelCount = labels.length;
  if (labelCount < 1) {
    return false;
  } else {
    return Belt_Array.every(labels, isValidLabel);
  }
}

function parseDomainName(domain) {
  if (!isValidDomainName(domain)) {
    return {
            TAG: "Error",
            _0: "InvalidDomainName"
          };
  }
  var length = domain.length;
  var name = length > 0 && domain.charAt(length - 1 | 0) === "." ? domain.slice(0, length - 1 | 0) : domain;
  var labels = name.split(".");
  return {
          TAG: "Ok",
          _0: {
            labels: labels,
            raw: domain
          }
        };
}

function isFqdn(domain) {
  var length = domain.raw.length;
  if (length > 0) {
    return domain.raw.charAt(length - 1 | 0) === ".";
  } else {
    return false;
  }
}

function labelCount(domain) {
  return domain.labels.length;
}

function tld(domain) {
  var count = domain.labels.length;
  if (count === 0) {
    return ;
  } else {
    return Belt_Array.get(domain.labels, count - 1 | 0);
  }
}

function sld(domain) {
  var count = domain.labels.length;
  if (count < 2) {
    return ;
  } else {
    return Belt_Array.get(domain.labels, count - 2 | 0);
  }
}

function isValidIPv4(address) {
  var parts = address.split(".");
  if (parts.length !== 4) {
    return false;
  } else {
    return Belt_Array.every(parts, (function (part) {
                  var n = Belt_Int.fromString(part);
                  if (n !== undefined && n >= 0) {
                    return n <= 255;
                  } else {
                    return false;
                  }
                }));
  }
}

function isValidIPv6(address) {
  var length = address.length;
  if (length === 0 || length > 45) {
    return false;
  }
  var groups = 0;
  var doubleColon = false;
  var i = 0;
  var valid = true;
  while(valid && i < length) {
    if ((i + 1 | 0) < length) {
      var $$char = address.charAt(i);
      var nextChar = address.charAt(i + 1 | 0);
      if ($$char === ":" && nextChar === ":") {
        if (doubleColon) {
          valid = false;
        } else {
          doubleColon = true;
          i = i + 2 | 0;
        }
      } else if ($$char === ":") {
        i = i + 1 | 0;
      } else {
        var groupLen = 0;
        while(i < length && address.charAt(i) !== ":") {
          var c = address.charAt(i);
          var code = c.charCodeAt(0) | 0;
          var isHex = code >= 48 && code <= 57 || code >= 65 && code <= 70 || code >= 97 && code <= 102;
          if (!isHex) {
            valid = false;
          }
          groupLen = groupLen + 1 | 0;
          if (groupLen > 4) {
            valid = false;
          }
          i = i + 1 | 0;
        };
        if (groupLen === 0) {
          valid = false;
        }
        groups = groups + 1 | 0;
      }
    } else {
      var $$char$1 = address.charAt(i);
      if ($$char$1 === ":") {
        i = i + 1 | 0;
      } else {
        var code$1 = $$char$1.charCodeAt(0) | 0;
        var isHex$1 = code$1 >= 48 && code$1 <= 57 || code$1 >= 65 && code$1 <= 70 || code$1 >= 97 && code$1 <= 102;
        if (!isHex$1) {
          valid = false;
        }
        groups = groups + 1 | 0;
        i = i + 1 | 0;
      }
    }
  };
  if (valid) {
    if (doubleColon) {
      return groups <= 7;
    } else {
      return groups === 8;
    }
  } else {
    return false;
  }
}

function parseMxRecord(data) {
  var spacePos = data.indexOf(" ");
  if (spacePos === -1) {
    return {
            TAG: "Error",
            _0: "InvalidRecordData"
          };
  }
  var priorityStr = data.slice(0, spacePos);
  var exchange = data.slice(spacePos + 1 | 0).trim();
  var priority = Belt_Int.fromString(priorityStr);
  if (priority !== undefined && !(priority < 0 || priority > 65535)) {
    if (isValidDomainName(exchange)) {
      return {
              TAG: "Ok",
              _0: {
                priority: priority,
                exchange: exchange
              }
            };
    } else {
      return {
              TAG: "Error",
              _0: "InvalidRecordData"
            };
    }
  } else {
    return {
            TAG: "Error",
            _0: "InvalidMxPriority"
          };
  }
}

function parseSrvRecord(data) {
  var parts = data.split(" ");
  if (parts.length < 4) {
    return {
            TAG: "Error",
            _0: "InvalidRecordData"
          };
  }
  var priorityStr = parts[0];
  var weightStr = parts[1];
  var portStr = parts[2];
  var target = parts[3];
  var match = Belt_Int.fromString(priorityStr);
  var match$1 = Belt_Int.fromString(weightStr);
  var match$2 = Belt_Int.fromString(portStr);
  if (match !== undefined && match$1 !== undefined && match$2 !== undefined && !(match < 0 || match > 65535 || match$1 < 0 || match$1 > 65535 || match$2 < 0 || match$2 > 65535 || target.length > 0 && !isValidDomainName(target))) {
    return {
            TAG: "Ok",
            _0: {
              priority: match,
              weight: match$1,
              port: match$2,
              target: target
            }
          };
  } else {
    return {
            TAG: "Error",
            _0: "InvalidRecordData"
          };
  }
}

function isValidTxtRecord(data) {
  var length = data.length;
  if (length > 65535) {
    return false;
  }
  var inQuote = false;
  var segmentLen = 0;
  var valid = true;
  for(var i = 0; i < length; ++i){
    if (valid) {
      var $$char = data.charAt(i);
      if ($$char === "\"") {
        inQuote = !inQuote;
        segmentLen = 0;
      } else if (inQuote) {
        segmentLen = segmentLen + 1 | 0;
        if (segmentLen > 255) {
          valid = false;
        }
        
      } else if ($$char !== " ") {
        valid = false;
      }
      
    }
    
  }
  if (valid) {
    return !inQuote;
  } else {
    return false;
  }
}

function isValidTtl(ttl) {
  if (ttl >= 0) {
    return ttl <= 2147483647;
  } else {
    return false;
  }
}

function parseTtl(str) {
  var length = str.length;
  if (length === 0) {
    return {
            TAG: "Error",
            _0: "InvalidTtl"
          };
  }
  var i = 0;
  while(i < length) {
    var $$char = str.charAt(i);
    var code = $$char.charCodeAt(0) | 0;
    i = code >= 48 && code <= 57 ? i + 1 | 0 : length + 1 | 0;
  };
  var numericEnd = i > length ? i - 1 | 0 : i;
  if (numericEnd === 0) {
    return {
            TAG: "Error",
            _0: "InvalidTtl"
          };
  }
  var numStr = str.slice(0, numericEnd);
  var value = Belt_Int.fromString(numStr);
  if (value === undefined) {
    return {
            TAG: "Error",
            _0: "InvalidTtl"
          };
  }
  if (numericEnd >= length) {
    if (isValidTtl(value)) {
      return {
              TAG: "Ok",
              _0: value
            };
    } else {
      return {
              TAG: "Error",
              _0: "InvalidTtl"
            };
    }
  }
  var suffix = str.charAt(numericEnd);
  var multiplier;
  switch (suffix) {
    case "D" :
    case "d" :
        multiplier = 86400;
        break;
    case "H" :
    case "h" :
        multiplier = 3600;
        break;
    case "M" :
    case "m" :
        multiplier = 60;
        break;
    case "S" :
    case "s" :
        multiplier = 1;
        break;
    case "W" :
    case "w" :
        multiplier = 604800;
        break;
    default:
      multiplier = undefined;
  }
  if (multiplier === undefined) {
    return {
            TAG: "Error",
            _0: "InvalidTtl"
          };
  }
  var result = Math.imul(value, multiplier);
  if (isValidTtl(result)) {
    return {
            TAG: "Ok",
            _0: result
          };
  } else {
    return {
            TAG: "Error",
            _0: "InvalidTtl"
          };
  }
}

function normalizeDomainName(domain) {
  if (!isValidDomainName(domain)) {
    return {
            TAG: "Error",
            _0: "InvalidDomainName"
          };
  }
  var length = domain.length;
  var name = length > 0 && domain.charAt(length - 1 | 0) === "." ? domain.slice(0, length - 1 | 0) : domain;
  return {
          TAG: "Ok",
          _0: name.toLowerCase()
        };
}

function dnsErrorToString(error) {
  switch (error) {
    case "InvalidDomainName" :
        return "Invalid domain name";
    case "InvalidLabel" :
        return "Invalid label";
    case "LabelTooLong" :
        return "Label is too long";
    case "DomainTooLong" :
        return "Domain name is too long";
    case "InvalidRecordType" :
        return "Invalid record type";
    case "InvalidRecordData" :
        return "Invalid record data";
    case "InvalidTtl" :
        return "Invalid TTL value";
    case "InvalidIpAddress" :
        return "Invalid IP address";
    case "InvalidMxPriority" :
        return "Invalid MX priority";
    
  }
}

var maxDomainLength = 253;

var maxLabelLength = 63;

export {
  maxDomainLength ,
  maxLabelLength ,
  recordTypeFromString ,
  recordTypeToString ,
  recordTypeValue ,
  recordClassFromString ,
  recordClassToString ,
  isAlnum ,
  isValidLabel ,
  isValidDomainName ,
  parseDomainName ,
  isFqdn ,
  labelCount ,
  tld ,
  sld ,
  isValidIPv4 ,
  isValidIPv6 ,
  parseMxRecord ,
  parseSrvRecord ,
  isValidTxtRecord ,
  isValidTtl ,
  parseTtl ,
  normalizeDomainName ,
  dnsErrorToString ,
}
/* No side effect */
