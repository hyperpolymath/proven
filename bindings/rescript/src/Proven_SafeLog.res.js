// Generated by ReScript, PLEASE EDIT WITH CARE

import * as Belt_Array from "rescript/lib/es6/belt_Array.js";

function levelFromString(str) {
  var lower = str.toLowerCase();
  switch (lower) {
    case "alert" :
        return "Alert";
    case "crit" :
    case "critical" :
        return "Critical";
    case "debug" :
        return "Debug";
    case "emerg" :
    case "emergency" :
        return "Emergency";
    case "err" :
    case "error" :
        return "Error";
    case "info" :
    case "information" :
        return "Info";
    case "notice" :
        return "Notice";
    case "trace" :
        return "Trace";
    case "warn" :
    case "warning" :
        return "Warning";
    default:
      return ;
  }
}

function levelToString(level) {
  switch (level) {
    case "Emergency" :
        return "EMERGENCY";
    case "Alert" :
        return "ALERT";
    case "Critical" :
        return "CRITICAL";
    case "Error" :
        return "ERROR";
    case "Warning" :
        return "WARNING";
    case "Notice" :
        return "NOTICE";
    case "Info" :
        return "INFO";
    case "Debug" :
        return "DEBUG";
    case "Trace" :
        return "TRACE";
    
  }
}

function levelToShortString(level) {
  switch (level) {
    case "Emergency" :
        return "EMR";
    case "Alert" :
        return "ALR";
    case "Critical" :
        return "CRT";
    case "Error" :
        return "ERR";
    case "Warning" :
        return "WRN";
    case "Notice" :
        return "NTC";
    case "Info" :
        return "INF";
    case "Debug" :
        return "DBG";
    case "Trace" :
        return "TRC";
    
  }
}

function levelSeverity(level) {
  switch (level) {
    case "Emergency" :
        return 0;
    case "Alert" :
        return 1;
    case "Critical" :
        return 2;
    case "Error" :
        return 3;
    case "Warning" :
        return 4;
    case "Notice" :
        return 5;
    case "Info" :
        return 6;
    case "Debug" :
        return 7;
    case "Trace" :
        return 8;
    
  }
}

function levelIsAtLeast(level, other) {
  return levelSeverity(level) <= levelSeverity(other);
}

function shouldLog(level, minimumLevel) {
  return levelSeverity(level) <= levelSeverity(minimumLevel);
}

function isValidFieldName(name) {
  var len = name.length;
  if (len === 0 || len > 64) {
    return false;
  }
  var first = name.charAt(0);
  var isValidFirst = first >= "a" && first <= "z" || first >= "A" && first <= "Z" || first === "_";
  if (!isValidFirst) {
    return false;
  }
  var valid = true;
  for(var i = 1; i < len; ++i){
    var c = name.charAt(i);
    var isAlpha = c >= "a" && c <= "z" || c >= "A" && c <= "Z";
    var isDigit = c >= "0" && c <= "9";
    var isSpecial = c === "_" || c === "-" || c === ".";
    if (!(isAlpha || isDigit || isSpecial)) {
      valid = false;
    }
    
  }
  return valid;
}

function isValidFieldValue(value) {
  var len = value.length;
  if (len > 1024) {
    return false;
  }
  var valid = true;
  for(var i = 0; i < len; ++i){
    var code = value.charCodeAt(i) | 0;
    if (code < 32 && code !== 10 && code !== 9 && code !== 13) {
      valid = false;
    }
    
  }
  return valid;
}

function isValidMessage(message) {
  var len = message.length;
  if (len > 8192) {
    return false;
  } else {
    return !message.includes("\x00");
  }
}

function fieldValueToString(value) {
  if (typeof value !== "object") {
    return "null";
  }
  switch (value.TAG) {
    case "String" :
        return value._0;
    case "Integer" :
    case "Float" :
        return String(value._0);
    case "Boolean" :
        if (value._0) {
          return "true";
        } else {
          return "false";
        }
    
  }
}

function createLogger() {
  return {
          name: undefined,
          minimumLevel: "Info",
          contextFields: [],
          enabled: true
        };
}

function createNamedLogger(name) {
  return {
          name: name,
          minimumLevel: "Info",
          contextFields: [],
          enabled: true
        };
}

function setLevel(logger, level) {
  logger.minimumLevel = level;
}

function setEnabled(logger, enabled) {
  logger.enabled = enabled;
}

function addContextField(logger, name, value) {
  if (!isValidFieldName(name)) {
    return {
            TAG: "Error",
            _0: "InvalidFieldName"
          };
  }
  if (logger.contextFields.length >= 32) {
    return {
            TAG: "Error",
            _0: "TooManyFields"
          };
  }
  var field = {
    name: name,
    value: value
  };
  logger.contextFields = Belt_Array.concat(logger.contextFields, [field]);
  return {
          TAG: "Ok",
          _0: undefined
        };
}

function clearContext(logger) {
  logger.contextFields = [];
}

function createEntry(level, message, fields, loggerName) {
  if (!isValidMessage(message)) {
    return {
            TAG: "Error",
            _0: "MessageTooLong"
          };
  }
  var invalidField = Belt_Array.some(fields, (function (f) {
          return !isValidFieldName(f.name);
        }));
  if (invalidField) {
    return {
            TAG: "Error",
            _0: "InvalidFieldName"
          };
  } else {
    return {
            TAG: "Ok",
            _0: {
              level: level,
              message: message,
              fields: fields,
              timestampMs: Date.now(),
              loggerName: loggerName,
              sourceLocation: undefined
            }
          };
  }
}

function log(logger, level, message, fields) {
  if (!logger.enabled || !shouldLog(level, logger.minimumLevel)) {
    return {
            TAG: "Ok",
            _0: {
              level: level,
              message: message,
              fields: fields,
              timestampMs: undefined,
              loggerName: logger.name,
              sourceLocation: undefined
            }
          };
  }
  var allFields = Belt_Array.concat(logger.contextFields, fields);
  return createEntry(level, message, allFields, logger.name);
}

function emergency(logger, message) {
  return log(logger, "Emergency", message, []);
}

function alert(logger, message) {
  return log(logger, "Alert", message, []);
}

function critical(logger, message) {
  return log(logger, "Critical", message, []);
}

function error(logger, message) {
  return log(logger, "Error", message, []);
}

function warning(logger, message) {
  return log(logger, "Warning", message, []);
}

function notice(logger, message) {
  return log(logger, "Notice", message, []);
}

function info(logger, message) {
  return log(logger, "Info", message, []);
}

function debug(logger, message) {
  return log(logger, "Debug", message, []);
}

function trace(logger, message) {
  return log(logger, "Trace", message, []);
}

function formatJson(entry) {
  var parts = [];
  parts.push("\"level\":\"" + levelToString(entry.level) + "\"");
  var escapedMsg = entry.message.replace(/\\\\/g, "\\\\").replace(/\"/g, "\\\"").replace(/\\n/g, "\\n").replace(/\\r/g, "\\r").replace(/\\t/g, "\\t");
  parts.push("\"message\":\"" + escapedMsg + "\"");
  var ts = entry.timestampMs;
  if (ts !== undefined) {
    parts.push("\"timestamp_ms\":" + String(ts));
  }
  var name = entry.loggerName;
  if (name !== undefined) {
    parts.push("\"logger\":\"" + name + "\"");
  }
  Belt_Array.forEach(entry.fields, (function (field) {
          var s = field.value;
          var valueStr;
          if (typeof s !== "object") {
            valueStr = "null";
          } else {
            switch (s.TAG) {
              case "String" :
                  valueStr = "\"" + s._0 + "\"";
                  break;
              case "Integer" :
              case "Float" :
                  valueStr = String(s._0);
                  break;
              case "Boolean" :
                  valueStr = s._0 ? "true" : "false";
                  break;
              
            }
          }
          parts.push("\"" + field.name + "\":" + valueStr);
        }));
  return "{" + parts.join(",") + "}";
}

function formatLine(entry) {
  var parts = [];
  parts.push("[" + levelToShortString(entry.level) + "]");
  var name = entry.loggerName;
  if (name !== undefined) {
    parts.push(name + ":");
  }
  parts.push(entry.message);
  if (entry.fields.length !== 0) {
    var fieldStrs = Belt_Array.map(entry.fields, (function (field) {
            return field.name + "=" + fieldValueToString(field.value);
          }));
    parts.push("{" + fieldStrs.join(", ") + "}");
  }
  return parts.join(" ");
}

function childLogger(parent, additionalContext) {
  return {
          name: parent.name,
          minimumLevel: parent.minimumLevel,
          contextFields: Belt_Array.concat(parent.contextFields, additionalContext),
          enabled: parent.enabled
        };
}

function field(name, value) {
  return {
          name: name,
          value: value
        };
}

function stringField(name, value) {
  return {
          name: name,
          value: {
            TAG: "String",
            _0: value
          }
        };
}

function intField(name, value) {
  return {
          name: name,
          value: {
            TAG: "Integer",
            _0: value
          }
        };
}

function floatField(name, value) {
  return {
          name: name,
          value: {
            TAG: "Float",
            _0: value
          }
        };
}

function boolField(name, value) {
  return {
          name: name,
          value: {
            TAG: "Boolean",
            _0: value
          }
        };
}

var maxMessageLength = 8192;

var maxFields = 32;

var maxFieldNameLength = 64;

var maxFieldValueLength = 1024;

export {
  maxMessageLength ,
  maxFields ,
  maxFieldNameLength ,
  maxFieldValueLength ,
  levelFromString ,
  levelToString ,
  levelToShortString ,
  levelSeverity ,
  levelIsAtLeast ,
  shouldLog ,
  isValidFieldName ,
  isValidFieldValue ,
  isValidMessage ,
  fieldValueToString ,
  createLogger ,
  createNamedLogger ,
  setLevel ,
  setEnabled ,
  addContextField ,
  clearContext ,
  createEntry ,
  log ,
  emergency ,
  alert ,
  critical ,
  error ,
  warning ,
  notice ,
  info ,
  debug ,
  trace ,
  formatJson ,
  formatLine ,
  childLogger ,
  field ,
  stringField ,
  intField ,
  floatField ,
  boolField ,
}
/* No side effect */
