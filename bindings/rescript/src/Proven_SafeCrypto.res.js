// Generated by ReScript, PLEASE EDIT WITH CARE

import * as Blake3 from "blake3";
import * as JsSha3 from "js-sha3";
import * as Belt_Array from "rescript/lib/es6/belt_Array.js";
import * as Caml_int32 from "rescript/lib/es6/caml_int32.js";
import * as Caml_option from "rescript/lib/es6/caml_option.js";

function toHex(bytes) {
  var hexChars = "0123456789abcdef";
  var result = "";
  for(var i = 0 ,i_finish = bytes.length; i < i_finish; ++i){
    var $$byte = bytes[i];
    result = result + hexChars.charAt(($$byte >>> 4)) + hexChars.charAt($$byte & 15);
  }
  return result;
}

function hexCharToInt(c) {
  switch (c) {
    case "0" :
        return 0;
    case "1" :
        return 1;
    case "2" :
        return 2;
    case "3" :
        return 3;
    case "4" :
        return 4;
    case "5" :
        return 5;
    case "6" :
        return 6;
    case "7" :
        return 7;
    case "8" :
        return 8;
    case "9" :
        return 9;
    case "A" :
    case "a" :
        return 10;
    case "B" :
    case "b" :
        return 11;
    case "C" :
    case "c" :
        return 12;
    case "D" :
    case "d" :
        return 13;
    case "E" :
    case "e" :
        return 14;
    case "F" :
    case "f" :
        return 15;
    default:
      return ;
  }
}

function fromHex(hex) {
  var len = hex.length;
  if (len % 2 !== 0) {
    return ;
  }
  try {
    var bytes = new Uint8Array(len / 2 | 0);
    var valid = true;
    for(var i = 0 ,i_finish = len / 2 | 0; i < i_finish; ++i){
      var high = hex.charAt((i << 1));
      var low = hex.charAt((i << 1) + 1 | 0);
      var match = hexCharToInt(high);
      var match$1 = hexCharToInt(low);
      if (match !== undefined && match$1 !== undefined) {
        bytes[i] = (match << 4) | match$1;
      } else {
        valid = false;
      }
    }
    if (valid) {
      return Caml_option.some(bytes);
    } else {
      return ;
    }
  }
  catch (exn){
    return ;
  }
}

function sha3_256(data) {
  if (data.length > 104857600) {
    return ;
  }
  try {
    return JsSha3.sha3_256(data);
  }
  catch (exn){
    return ;
  }
}

function sha3_256Bytes(data) {
  if (data.length > 104857600) {
    return ;
  }
  try {
    var arr = [];
    for(var i = 0 ,i_finish = data.length; i < i_finish; ++i){
      arr.push(data[i]);
    }
    return JsSha3.sha3_256.array(arr);
  }
  catch (exn){
    return ;
  }
}

function sha3_512(data) {
  if (data.length > 104857600) {
    return ;
  }
  try {
    return JsSha3.sha3_512(data);
  }
  catch (exn){
    return ;
  }
}

function sha3_512Bytes(data) {
  if (data.length > 104857600) {
    return ;
  }
  try {
    var arr = [];
    for(var i = 0 ,i_finish = data.length; i < i_finish; ++i){
      arr.push(data[i]);
    }
    return JsSha3.sha3_512.array(arr);
  }
  catch (exn){
    return ;
  }
}

function blake3(data) {
  if (data.length > 104857600) {
    return ;
  }
  try {
    var hash = Blake3.hash(data);
    return toHex(hash);
  }
  catch (exn){
    return ;
  }
}

function blake3String(data) {
  try {
    var bytes = (new TextEncoder().encode(data));
    return blake3(bytes);
  }
  catch (exn){
    return ;
  }
}

function blake3Keyed(key, data) {
  if (key.length !== 32) {
    return ;
  }
  if (data.length > 104857600) {
    return ;
  }
  try {
    var hash = Blake3.keyedHash(key, data);
    return toHex(hash);
  }
  catch (exn){
    return ;
  }
}

function blake3DeriveKeyFromContext(context, material) {
  if (material.length === 0) {
    return ;
  }
  try {
    var derived = Blake3.deriveKey(context, material);
    return toHex(derived);
  }
  catch (exn){
    return ;
  }
}

function constantTimeEq(a, b) {
  if (a.length !== b.length) {
    return false;
  }
  var diff = {
    contents: 0
  };
  Belt_Array.forEachWithIndex(a, (function (i, aVal) {
          var bVal = b[i];
          diff.contents = diff.contents | aVal ^ bVal;
        }));
  return diff.contents === 0;
}

function secureCompare(a, b) {
  var aBytes = Belt_Array.map(a.split(""), (function (c) {
          return c.charCodeAt(0) | 0;
        }));
  var bBytes = Belt_Array.map(b.split(""), (function (c) {
          return c.charCodeAt(0) | 0;
        }));
  return constantTimeEq(aBytes, bBytes);
}

function hmacSha3_256(key, data) {
  if (key.length === 0) {
    return ;
  }
  if (data.length > 104857600) {
    return ;
  }
  try {
    var hmac = JsSha3.sha3_256["hmac.create"](key);
    hmac.update(data);
    return hmac.hex();
  }
  catch (exn){
    return ;
  }
}

function verifyHmacSha3_256(key, data, expectedMac) {
  var computed = hmacSha3_256(key, data);
  if (computed !== undefined) {
    return secureCompare(computed, expectedMac);
  } else {
    return false;
  }
}

function randomBytes(length) {
  if (length <= 0 || length > 1048576) {
    return ;
  }
  try {
    var buffer = new Uint8Array(length);
    return Caml_option.some(globalThis.crypto.getRandomValues(buffer));
  }
  catch (exn){
    return ;
  }
}

function randomHex(byteLength) {
  var bytes = randomBytes(byteLength);
  if (bytes !== undefined) {
    return toHex(Caml_option.valFromOption(bytes));
  }
  
}

function randomInt(max) {
  if (max <= 0) {
    return ;
  }
  var bytes = randomBytes(4);
  if (bytes === undefined) {
    return ;
  }
  var bytes$1 = Caml_option.valFromOption(bytes);
  var value = bytes$1[0] | (bytes$1[1] << 8) | (bytes$1[2] << 16) | ((bytes$1[3] & 127) << 24);
  return Caml_int32.mod_(value, max);
}

export {
  toHex ,
  hexCharToInt ,
  fromHex ,
  sha3_256 ,
  sha3_256Bytes ,
  sha3_512 ,
  sha3_512Bytes ,
  blake3 ,
  blake3String ,
  blake3Keyed ,
  blake3DeriveKeyFromContext ,
  constantTimeEq ,
  secureCompare ,
  hmacSha3_256 ,
  verifyHmacSha3_256 ,
  randomBytes ,
  randomHex ,
  randomInt ,
}
/* blake3 Not a pure module */
