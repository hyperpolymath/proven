// Generated by ReScript, PLEASE EDIT WITH CARE

import * as Belt_Array from "rescript/lib/es6/belt_Array.js";
import * as Caml_option from "rescript/lib/es6/caml_option.js";

function escapeText(input) {
  return input.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;").replace(/'/g, "&apos;").replace(/\"/g, "&quot;");
}

function escapeAttribute(input) {
  var escaped = escapeText(input);
  var result = escaped;
  for(var characterCode = 0; characterCode <= 31; ++characterCode){
    if (characterCode !== 9 && characterCode !== 10 && characterCode !== 13) {
      var charPattern = String.fromCharCode(characterCode);
      var replacement = "&#x" + characterCode.toString(16).toUpperCase() + ";";
      result = result.replace(new RegExp(charPattern), replacement);
    }
    
  }
  return result;
}

function escapeWithMode(input, mode) {
  switch (mode) {
    case "Text" :
        return escapeText(input);
    case "Attribute" :
        return escapeAttribute(input);
    case "Cdata" :
        return input;
    
  }
}

function $$unescape(input) {
  return input.replace(/&lt;/g, "<").replace(/&gt;/g, ">").replace(/&apos;/g, "'").replace(/&quot;/g, "\"").replace(/&amp;/g, "&");
}

function isValidXmlCharCode(codePoint) {
  if (codePoint === 9 || codePoint === 10 || codePoint === 13 || codePoint >= 32 && codePoint <= 55295 || codePoint >= 57344 && codePoint <= 65533) {
    return true;
  } else if (codePoint >= 65536) {
    return codePoint <= 1114111;
  } else {
    return false;
  }
}

function isValidNameStartChar(codePoint) {
  if (codePoint === 58 || codePoint >= 65 && codePoint <= 90 || codePoint === 95 || codePoint >= 97 && codePoint <= 122 || codePoint >= 192 && codePoint <= 214 || codePoint >= 216 && codePoint <= 246 || codePoint >= 248 && codePoint <= 767 || codePoint >= 880 && codePoint <= 893 || codePoint >= 895 && codePoint <= 8191 || codePoint >= 8204 && codePoint <= 8205 || codePoint >= 8304 && codePoint <= 8591 || codePoint >= 11264 && codePoint <= 12271 || codePoint >= 12289 && codePoint <= 55295 || codePoint >= 63744 && codePoint <= 64975 || codePoint >= 65008 && codePoint <= 65533) {
    return true;
  } else if (codePoint >= 65536) {
    return codePoint <= 983039;
  } else {
    return false;
  }
}

function isValidNameChar(codePoint) {
  if (isValidNameStartChar(codePoint) || codePoint === 45 || codePoint === 46 || codePoint >= 48 && codePoint <= 57 || codePoint === 183 || codePoint >= 768 && codePoint <= 879) {
    return true;
  } else if (codePoint >= 8255) {
    return codePoint <= 8256;
  } else {
    return false;
  }
}

function isValidName(name) {
  if (name.length === 0) {
    return false;
  }
  var firstCode = name.charCodeAt(0) | 0;
  if (!isValidNameStartChar(firstCode)) {
    return false;
  }
  var valid = true;
  var length = name.length;
  for(var index = 1; index < length; ++index){
    if (valid) {
      var charCode = name.charCodeAt(index) | 0;
      if (!isValidNameChar(charCode)) {
        valid = false;
      }
      
    }
    
  }
  return valid;
}

function isValidContent(content) {
  var valid = true;
  var length = content.length;
  for(var index = 0; index < length; ++index){
    if (valid) {
      var charCode = content.charCodeAt(index) | 0;
      if (!isValidXmlCharCode(charCode)) {
        valid = false;
      }
      
    }
    
  }
  return valid;
}

function sanitizeContent(input) {
  var result = "";
  var length = input.length;
  for(var index = 0; index < length; ++index){
    var charCode = input.charCodeAt(index) | 0;
    if (isValidXmlCharCode(charCode)) {
      result = result + input.charAt(index);
    }
    
  }
  return result;
}

function createElement(tagName, contentOpt, attributesOpt, param) {
  var content = contentOpt !== undefined ? Caml_option.valFromOption(contentOpt) : undefined;
  var attributes = attributesOpt !== undefined ? attributesOpt : [];
  if (!isValidName(tagName)) {
    return {
            TAG: "Error",
            _0: "InvalidName"
          };
  }
  var attributesValid = Belt_Array.every(attributes, (function (attr) {
          return isValidName(attr.name);
        }));
  if (!attributesValid) {
    return {
            TAG: "Error",
            _0: "InvalidName"
          };
  }
  var result = {
    contents: "<" + tagName
  };
  Belt_Array.forEach(attributes, (function (attr) {
          result.contents = result.contents + " " + attr.name + "=\"" + escapeAttribute(attr.value) + "\"";
        }));
  if (content !== undefined) {
    result.contents = result.contents + ">" + escapeText(content) + "</" + tagName + ">";
  } else {
    result.contents = result.contents + "/>";
  }
  return {
          TAG: "Ok",
          _0: result.contents
        };
}

function createCDATA(content) {
  if (content.includes("]]>")) {
    return {
            TAG: "Error",
            _0: "InvalidCharacter"
          };
  } else {
    return {
            TAG: "Ok",
            _0: "<![CDATA[" + content + "]]>"
          };
  }
}

function createComment(content) {
  if (content.includes("--") || content.length > 0 && content.endsWith("-")) {
    return {
            TAG: "Error",
            _0: "InvalidCharacter"
          };
  } else {
    return {
            TAG: "Ok",
            _0: "<!-- " + content + " -->"
          };
  }
}

function isWellFormed(input) {
  var trimmed = input.trim();
  if (trimmed.length === 0) {
    return false;
  }
  if (!trimmed.startsWith("<")) {
    return false;
  }
  var depth = 0;
  var valid = true;
  var length = trimmed.length;
  var index = 0;
  while(index < length && valid) {
    var currentChar = trimmed.charAt(index);
    if (currentChar === "<") {
      if ((index + 1 | 0) >= length) {
        valid = false;
      } else {
        var nextChar = trimmed.charAt(index + 1 | 0);
        if (nextChar === "/") {
          if (depth === 0) {
            valid = false;
          } else {
            depth = depth - 1 | 0;
          }
        } else if (!(nextChar === "?" || nextChar === "!")) {
          var tagEnd = trimmed.indexOf(">", index);
          if (tagEnd === -1) {
            valid = false;
          } else {
            var prevChar = trimmed.charAt(tagEnd - 1 | 0);
            if (prevChar !== "/") {
              depth = depth + 1 | 0;
            }
            
          }
        }
        
      }
    }
    index = index + 1 | 0;
  };
  if (valid) {
    return depth === 0;
  } else {
    return false;
  }
}

function createDeclaration(versionOpt, encodingOpt, standaloneOpt, param) {
  var version = versionOpt !== undefined ? versionOpt : "1.0";
  var encoding = encodingOpt !== undefined ? Caml_option.valFromOption(encodingOpt) : "UTF-8";
  var standalone = standaloneOpt !== undefined ? Caml_option.valFromOption(standaloneOpt) : undefined;
  var result = "<?xml version=\"" + version + "\"";
  if (encoding !== undefined) {
    result = result + (" encoding=\"" + encoding + "\"");
  }
  if (standalone !== undefined) {
    result = standalone ? result + " standalone=\"yes\"" : result + " standalone=\"no\"";
  }
  return result + "?>";
}

function parseNumericEntity(entity) {
  if (entity.length < 3) {
    return ;
  }
  if (entity.charAt(0) !== "#") {
    return ;
  }
  var isHex = entity.charAt(1) === "x" || entity.charAt(1) === "X";
  var numericPart = isHex ? entity.slice(2) : entity.slice(1);
  var radix = isHex ? 16 : 10;
  var value = parseInt(numericPart, radix);
  if (Number.isNaN(value)) {
    return ;
  }
  var codePoint = value | 0;
  if (isValidXmlCharCode(codePoint)) {
    return String.fromCodePoint(codePoint);
  }
  
}

export {
  escapeText ,
  escapeAttribute ,
  escapeWithMode ,
  $$unescape ,
  isValidXmlCharCode ,
  isValidNameStartChar ,
  isValidNameChar ,
  isValidName ,
  isValidContent ,
  sanitizeContent ,
  createElement ,
  createCDATA ,
  createComment ,
  isWellFormed ,
  createDeclaration ,
  parseNumericEntity ,
}
/* No side effect */
