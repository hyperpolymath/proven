// Generated by ReScript, PLEASE EDIT WITH CARE

import * as Belt_Int from "rescript/lib/es6/belt_Int.js";
import * as Caml_array from "rescript/lib/es6/caml_array.js";
import * as Belt_Option from "rescript/lib/es6/belt_Option.js";

function ok() {
  return {
          valid: true,
          errorPath: undefined,
          errorMessage: undefined
        };
}

function fail(path, message) {
  return {
          valid: false,
          errorPath: path,
          errorMessage: message
        };
}

function defaultFieldSchema() {
  return {
          valueType: "StringType",
          required: false,
          minLength: undefined,
          maxLength: undefined,
          minValue: undefined,
          maxValue: undefined,
          minItems: undefined,
          maxItems: undefined,
          format: "NoFormat",
          pattern: undefined,
          enumValues: undefined
        };
}

function createObjectSchema(maxFieldsOpt, param) {
  var maxFields = maxFieldsOpt !== undefined ? maxFieldsOpt : 100;
  return {
          fields: [],
          minProperties: 0,
          maxProperties: maxFields,
          additionalPropertiesAllowed: true
        };
}

function addField(schema, name, fieldSchema) {
  if (schema.fields.length >= schema.maxProperties) {
    return {
            TAG: "Error",
            _0: "SchemaInvalid"
          };
  } else {
    schema.fields = schema.fields.concat([{
            name: name,
            schema: fieldSchema
          }]);
    return {
            TAG: "Ok",
            _0: undefined
          };
  }
}

function getFieldSchema(schema, name) {
  var result = {
    contents: undefined
  };
  schema.fields.forEach(function (entry) {
        if (entry.name === name) {
          result.contents = entry.schema;
          return ;
        }
        
      });
  return result.contents;
}

function hasField(schema, name) {
  return Belt_Option.isSome(getFieldSchema(schema, name));
}

function getRequiredFields(schema) {
  return schema.fields.filter(function (entry) {
                return entry.schema.required;
              }).map(function (entry) {
              return entry.name;
            });
}

function validatePropertyCount(schema, count) {
  if (count < schema.minProperties) {
    return {
            TAG: "Error",
            _0: "MinPropertiesNotMet"
          };
  } else if (count > schema.maxProperties) {
    return {
            TAG: "Error",
            _0: "MaxPropertiesExceeded"
          };
  } else {
    return {
            TAG: "Ok",
            _0: undefined
          };
  }
}

function isFieldAllowed(schema, name) {
  if (schema.additionalPropertiesAllowed) {
    return true;
  } else {
    return hasField(schema, name);
  }
}

function disallowAdditionalProperties(schema) {
  
}

function isValidEmail(value) {
  var length = value.length;
  if (length === 0 || length > 254) {
    return false;
  }
  var atPos = value.indexOf("@");
  if (atPos === -1 || atPos === 0) {
    return false;
  }
  if (atPos === (length - 1 | 0)) {
    return false;
  }
  var local = value.slice(0, atPos);
  var domain = value.slice(atPos + 1 | 0);
  if (local.length <= 64 && domain.length > 0) {
    return domain.includes(".");
  } else {
    return false;
  }
}

function isValidUri(value) {
  if (value.length === 0) {
    return false;
  }
  var pos = value.indexOf("://");
  if (pos === -1 || pos === 0) {
    return false;
  }
  var scheme = value.slice(0, pos);
  var schemeChars = scheme.split("");
  return schemeChars.every(function (c) {
              var code = c.charCodeAt(0);
              if (code >= 48.0 && code <= 57.0 || code >= 65.0 && code <= 90.0 || code >= 97.0 && code <= 122.0 || code === 43.0 || code === 45.0) {
                return true;
              } else {
                return code === 46.0;
              }
            });
}

function isValidDate(value) {
  if (value.length !== 10) {
    return false;
  }
  if (value.charAt(4) !== "-" || value.charAt(7) !== "-") {
    return false;
  }
  var match = Belt_Int.fromString(value.slice(0, 4));
  var match$1 = Belt_Int.fromString(value.slice(5, 7));
  var match$2 = Belt_Int.fromString(value.slice(8, 10));
  if (match !== undefined && match$1 !== undefined && match$2 !== undefined && match$1 >= 1 && match$1 <= 12 && match$2 >= 1) {
    return match$2 <= 31;
  } else {
    return false;
  }
}

function isValidDatetime(value) {
  if (value.length < 19) {
    return false;
  }
  if (!isValidDate(value.slice(0, 10))) {
    return false;
  }
  var sep = value.charAt(10);
  if (sep !== "T" && sep !== " ") {
    return false;
  }
  if (value.charAt(13) !== ":" || value.charAt(16) !== ":") {
    return false;
  }
  var match = Belt_Int.fromString(value.slice(11, 13));
  var match$1 = Belt_Int.fromString(value.slice(14, 16));
  var match$2 = Belt_Int.fromString(value.slice(17, 19));
  if (match !== undefined && match$1 !== undefined && match$2 !== undefined && match >= 0 && match <= 23 && match$1 >= 0 && match$1 <= 59 && match$2 >= 0) {
    return match$2 <= 59;
  } else {
    return false;
  }
}

function isValidUuid(value) {
  if (value.length !== 36) {
    return false;
  }
  if (value.charAt(8) !== "-" || value.charAt(13) !== "-" || value.charAt(18) !== "-" || value.charAt(23) !== "-") {
    return false;
  }
  var chars = value.split("");
  return chars.every(function (c, i) {
              if (i === 8 || i === 13 || i === 18 || i === 23) {
                return true;
              }
              var code = c.charCodeAt(0);
              if (code >= 48.0 && code <= 57.0 || code >= 65.0 && code <= 70.0) {
                return true;
              } else if (code >= 97.0) {
                return code <= 102.0;
              } else {
                return false;
              }
            });
}

function isValidIpv4(value) {
  var parts = value.split(".");
  if (parts.length !== 4) {
    return false;
  } else {
    return parts.every(function (part) {
                var n = Belt_Int.fromString(part);
                if (n !== undefined && n >= 0 && n <= 255) {
                  return part.length <= 3;
                } else {
                  return false;
                }
              });
  }
}

function isValidIpv6(value) {
  var length = value.length;
  if (length === 0 || length > 45) {
    return false;
  }
  var groups = 0;
  var hasDoubleColon = false;
  var consecutiveColons = 0;
  var hexDigits = 0;
  var valid = true;
  for(var i = 0; i < length; ++i){
    if (valid) {
      var c = value.charAt(i);
      if (c === ":") {
        consecutiveColons = consecutiveColons + 1 | 0;
        if (consecutiveColons === 2) {
          if (hasDoubleColon) {
            valid = false;
          } else {
            hasDoubleColon = true;
          }
        } else if (consecutiveColons > 2) {
          valid = false;
        }
        if (hexDigits > 0) {
          groups = groups + 1 | 0;
        }
        hexDigits = 0;
      } else {
        var code = c.charCodeAt(0);
        var isHex = code >= 48.0 && code <= 57.0 || code >= 65.0 && code <= 70.0 || code >= 97.0 && code <= 102.0;
        if (isHex) {
          consecutiveColons = 0;
          hexDigits = hexDigits + 1 | 0;
          if (hexDigits > 4) {
            valid = false;
          }
          
        } else {
          valid = false;
        }
      }
    }
    
  }
  if (hexDigits > 0) {
    groups = groups + 1 | 0;
  }
  if (valid) {
    if (hasDoubleColon) {
      return groups <= 8;
    } else {
      return groups === 8;
    }
  } else {
    return false;
  }
}

function isValidHostname(value) {
  var length = value.length;
  if (length === 0 || length > 253) {
    return false;
  }
  var labelLen = 0;
  var valid = true;
  for(var i = 0; i < length; ++i){
    if (valid) {
      var c = value.charAt(i);
      if (c === ".") {
        if (labelLen === 0 || labelLen > 63) {
          valid = false;
        }
        labelLen = 0;
      } else {
        var code = c.charCodeAt(0);
        var isAlphaNum = code >= 48.0 && code <= 57.0 || code >= 65.0 && code <= 90.0 || code >= 97.0 && code <= 122.0 || code === 45.0;
        if (isAlphaNum) {
          labelLen = labelLen + 1 | 0;
          if (labelLen > 63) {
            valid = false;
          }
          
        } else {
          valid = false;
        }
      }
    }
    
  }
  if (valid && labelLen > 0) {
    return labelLen <= 63;
  } else {
    return false;
  }
}

function validateFormat(value, format) {
  var valid;
  switch (format) {
    case "NoFormat" :
        valid = true;
        break;
    case "EmailFormat" :
        valid = isValidEmail(value);
        break;
    case "UriFormat" :
        valid = isValidUri(value);
        break;
    case "DateFormat" :
        valid = isValidDate(value);
        break;
    case "DatetimeFormat" :
        valid = isValidDatetime(value);
        break;
    case "UuidFormat" :
        valid = isValidUuid(value);
        break;
    case "Ipv4Format" :
        valid = isValidIpv4(value);
        break;
    case "Ipv6Format" :
        valid = isValidIpv6(value);
        break;
    case "HostnameFormat" :
        valid = isValidHostname(value);
        break;
    
  }
  if (valid) {
    return {
            TAG: "Ok",
            _0: undefined
          };
  } else {
    return {
            TAG: "Error",
            _0: "InvalidFormat"
          };
  }
}

function validateString(schema, value) {
  if (schema.valueType !== "StringType") {
    return {
            TAG: "Error",
            _0: "TypeMismatch"
          };
  }
  var length = value.length;
  var min = schema.minLength;
  var exit = 0;
  if (min !== undefined) {
    if (length < min) {
      return {
              TAG: "Error",
              _0: "StringTooShort"
            };
    }
    exit = 1;
  } else {
    exit = 1;
  }
  if (exit === 1) {
    var max = schema.maxLength;
    var exit$1 = 0;
    if (max !== undefined) {
      if (length > max) {
        return {
                TAG: "Error",
                _0: "StringTooLong"
              };
      }
      exit$1 = 2;
    } else {
      exit$1 = 2;
    }
    if (exit$1 === 2) {
      var e = validateFormat(value, schema.format);
      if (e.TAG !== "Ok") {
        return {
                TAG: "Error",
                _0: e._0
              };
      }
      var enums = schema.enumValues;
      if (enums !== undefined && !enums.includes(value)) {
        return {
                TAG: "Error",
                _0: "EnumValueInvalid"
              };
      } else {
        return {
                TAG: "Ok",
                _0: undefined
              };
      }
    }
    
  }
  
}

function validateInteger(schema, value) {
  if (schema.valueType !== "IntegerType" && schema.valueType !== "NumberType") {
    return {
            TAG: "Error",
            _0: "TypeMismatch"
          };
  }
  var min = schema.minValue;
  if (min !== undefined && value < min) {
    return {
            TAG: "Error",
            _0: "ValueOutOfRange"
          };
  }
  var max = schema.maxValue;
  if (max !== undefined && value > max) {
    return {
            TAG: "Error",
            _0: "ValueOutOfRange"
          };
  } else {
    return {
            TAG: "Ok",
            _0: undefined
          };
  }
}

function validateArrayLength(schema, length) {
  if (schema.valueType !== "ArrayType") {
    return {
            TAG: "Error",
            _0: "TypeMismatch"
          };
  }
  var min = schema.minItems;
  if (min !== undefined && length < min) {
    return {
            TAG: "Error",
            _0: "ArrayTooShort"
          };
  }
  var max = schema.maxItems;
  if (max !== undefined && length > max) {
    return {
            TAG: "Error",
            _0: "ArrayTooLong"
          };
  } else {
    return {
            TAG: "Ok",
            _0: undefined
          };
  }
}

function create(maxFieldsOpt, param) {
  var maxFields = maxFieldsOpt !== undefined ? maxFieldsOpt : 100;
  return {
          schema: createObjectSchema(maxFields, undefined)
        };
}

function requiredString(builder, name) {
  var init = defaultFieldSchema();
  addField(builder.schema, name, {
        valueType: "StringType",
        required: true,
        minLength: init.minLength,
        maxLength: init.maxLength,
        minValue: init.minValue,
        maxValue: init.maxValue,
        minItems: init.minItems,
        maxItems: init.maxItems,
        format: init.format,
        pattern: init.pattern,
        enumValues: init.enumValues
      });
  return builder;
}

function optionalString(builder, name) {
  var init = defaultFieldSchema();
  addField(builder.schema, name, {
        valueType: "StringType",
        required: false,
        minLength: init.minLength,
        maxLength: init.maxLength,
        minValue: init.minValue,
        maxValue: init.maxValue,
        minItems: init.minItems,
        maxItems: init.maxItems,
        format: init.format,
        pattern: init.pattern,
        enumValues: init.enumValues
      });
  return builder;
}

function requiredInteger(builder, name) {
  var init = defaultFieldSchema();
  addField(builder.schema, name, {
        valueType: "IntegerType",
        required: true,
        minLength: init.minLength,
        maxLength: init.maxLength,
        minValue: init.minValue,
        maxValue: init.maxValue,
        minItems: init.minItems,
        maxItems: init.maxItems,
        format: init.format,
        pattern: init.pattern,
        enumValues: init.enumValues
      });
  return builder;
}

function optionalInteger(builder, name) {
  var init = defaultFieldSchema();
  addField(builder.schema, name, {
        valueType: "IntegerType",
        required: false,
        minLength: init.minLength,
        maxLength: init.maxLength,
        minValue: init.minValue,
        maxValue: init.maxValue,
        minItems: init.minItems,
        maxItems: init.maxItems,
        format: init.format,
        pattern: init.pattern,
        enumValues: init.enumValues
      });
  return builder;
}

function requiredBoolean(builder, name) {
  var init = defaultFieldSchema();
  addField(builder.schema, name, {
        valueType: "BooleanType",
        required: true,
        minLength: init.minLength,
        maxLength: init.maxLength,
        minValue: init.minValue,
        maxValue: init.maxValue,
        minItems: init.minItems,
        maxItems: init.maxItems,
        format: init.format,
        pattern: init.pattern,
        enumValues: init.enumValues
      });
  return builder;
}

function boundedString(builder, name, minLen, maxLen, required) {
  var init = defaultFieldSchema();
  addField(builder.schema, name, {
        valueType: "StringType",
        required: required,
        minLength: minLen,
        maxLength: maxLen,
        minValue: init.minValue,
        maxValue: init.maxValue,
        minItems: init.minItems,
        maxItems: init.maxItems,
        format: init.format,
        pattern: init.pattern,
        enumValues: init.enumValues
      });
  return builder;
}

function boundedInteger(builder, name, minVal, maxVal, required) {
  var init = defaultFieldSchema();
  addField(builder.schema, name, {
        valueType: "IntegerType",
        required: required,
        minLength: init.minLength,
        maxLength: init.maxLength,
        minValue: minVal,
        maxValue: maxVal,
        minItems: init.minItems,
        maxItems: init.maxItems,
        format: init.format,
        pattern: init.pattern,
        enumValues: init.enumValues
      });
  return builder;
}

function emailField(builder, name, required) {
  var init = defaultFieldSchema();
  addField(builder.schema, name, {
        valueType: "StringType",
        required: required,
        minLength: init.minLength,
        maxLength: init.maxLength,
        minValue: init.minValue,
        maxValue: init.maxValue,
        minItems: init.minItems,
        maxItems: init.maxItems,
        format: "EmailFormat",
        pattern: init.pattern,
        enumValues: init.enumValues
      });
  return builder;
}

function uuidField(builder, name, required) {
  var init = defaultFieldSchema();
  addField(builder.schema, name, {
        valueType: "StringType",
        required: required,
        minLength: init.minLength,
        maxLength: init.maxLength,
        minValue: init.minValue,
        maxValue: init.maxValue,
        minItems: init.minItems,
        maxItems: init.maxItems,
        format: "UuidFormat",
        pattern: init.pattern,
        enumValues: init.enumValues
      });
  return builder;
}

function enumField(builder, name, values, required) {
  var init = defaultFieldSchema();
  addField(builder.schema, name, {
        valueType: "StringType",
        required: required,
        minLength: init.minLength,
        maxLength: init.maxLength,
        minValue: init.minValue,
        maxValue: init.maxValue,
        minItems: init.minItems,
        maxItems: init.maxItems,
        format: init.format,
        pattern: init.pattern,
        enumValues: values
      });
  return builder;
}

function strict(builder) {
  var init = builder.schema;
  builder.schema = {
    fields: init.fields,
    minProperties: init.minProperties,
    maxProperties: init.maxProperties,
    additionalPropertiesAllowed: false
  };
  return builder;
}

function build(builder) {
  return builder.schema;
}

var Builder = {
  create: create,
  requiredString: requiredString,
  optionalString: optionalString,
  requiredInteger: requiredInteger,
  optionalInteger: optionalInteger,
  requiredBoolean: requiredBoolean,
  boundedString: boundedString,
  boundedInteger: boundedInteger,
  emailField: emailField,
  uuidField: uuidField,
  enumField: enumField,
  strict: strict,
  build: build
};

function validateObject(schema, fields) {
  var fieldCount = fields.length;
  var e = validatePropertyCount(schema, fieldCount);
  if (e.TAG === "Ok") {
    var requiredFields = getRequiredFields(schema);
    var fieldNames = fields.map(function (param) {
          return param[0];
        });
    var missingRequired = requiredFields.filter(function (req) {
          return !fieldNames.includes(req);
        });
    if (missingRequired.length > 0) {
      return {
              valid: false,
              errorPath: Caml_array.get(missingRequired, 0),
              errorMessage: "Required field missing"
            };
    }
    if (schema.additionalPropertiesAllowed) {
      return {
              valid: true,
              errorPath: undefined,
              errorMessage: undefined
            };
    }
    var disallowed = fieldNames.filter(function (name) {
          return !hasField(schema, name);
        });
    if (disallowed.length > 0) {
      return {
              valid: false,
              errorPath: Caml_array.get(disallowed, 0),
              errorMessage: "Additional property not allowed"
            };
    } else {
      return {
              valid: true,
              errorPath: undefined,
              errorMessage: undefined
            };
    }
  }
  var tmp;
  switch (e._0) {
    case "MaxPropertiesExceeded" :
        tmp = "Too many properties";
        break;
    case "MinPropertiesNotMet" :
        tmp = "Too few properties";
        break;
    default:
      tmp = "Property count validation failed";
  }
  return {
          valid: false,
          errorPath: undefined,
          errorMessage: tmp
        };
}

export {
  ok ,
  fail ,
  defaultFieldSchema ,
  createObjectSchema ,
  addField ,
  getFieldSchema ,
  hasField ,
  getRequiredFields ,
  validatePropertyCount ,
  isFieldAllowed ,
  disallowAdditionalProperties ,
  isValidEmail ,
  isValidUri ,
  isValidDate ,
  isValidDatetime ,
  isValidUuid ,
  isValidIpv4 ,
  isValidIpv6 ,
  isValidHostname ,
  validateFormat ,
  validateString ,
  validateInteger ,
  validateArrayLength ,
  Builder ,
  validateObject ,
}
/* No side effect */
